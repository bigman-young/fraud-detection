<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PubSubTransactionProducer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Real-Time Fraud Detection System</a> &gt; <a href="index.source.html" class="el_package">com.hsbc.fraud.producer</a> &gt; <span class="el_source">PubSubTransactionProducer.java</span></div><h1>PubSubTransactionProducer.java</h1><pre class="source lang-java linenums">package com.hsbc.fraud.producer;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.SerializationFeature;
import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
import com.google.api.core.ApiFuture;
import com.google.api.core.ApiFutureCallback;
import com.google.api.core.ApiFutures;
import com.google.api.gax.rpc.ApiException;
import com.google.cloud.pubsub.v1.Publisher;
import com.google.common.util.concurrent.MoreExecutors;
import com.google.protobuf.ByteString;
import com.google.pubsub.v1.PubsubMessage;
import com.google.pubsub.v1.TopicName;
import com.hsbc.fraud.model.Transaction;
import com.hsbc.fraud.model.TransactionType;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.IOException;
import java.math.BigDecimal;
import java.time.Instant;
import java.util.Random;
import java.util.UUID;
import java.util.concurrent.TimeUnit;
import java.util.concurrent.atomic.AtomicBoolean;
import java.util.concurrent.atomic.AtomicLong;

/**
 * Transaction Producer that generates simulated transactions and sends to Google Cloud Pub/Sub.
 * 
 * Prerequisites:
 *   1. Set up Google Cloud authentication:
 *      - Set GOOGLE_APPLICATION_CREDENTIALS environment variable to your service account key file
 *      - Or run on GCP with appropriate IAM permissions
 *   2. Create the Pub/Sub topic in your GCP project
 * 
 * Usage:
 *   java -cp fraud-detection-system-1.0.0.jar com.hsbc.fraud.producer.PubSubTransactionProducer
 * 
 * Environment variables:
 *   GOOGLE_CLOUD_PROJECT - GCP project ID (required)
 *   PUBSUB_TOPIC - Pub/Sub topic name (default: transactions)
 *   TPS - Transactions per second (default: 10)
 *   FRAUD_RATE - Percentage of fraudulent transactions (default: 15)
 *   GOOGLE_APPLICATION_CREDENTIALS - Path to service account key JSON file
 */
public class PubSubTransactionProducer {

<span class="nc" id="L50">    private static final Logger LOG = LoggerFactory.getLogger(PubSubTransactionProducer.class);</span>

    // Configuration defaults
    private static final String DEFAULT_TOPIC = &quot;transactions&quot;;
    private static final int DEFAULT_TPS = 10;
    private static final int DEFAULT_FRAUD_RATE = 15;

    // Account pools
<span class="nc" id="L58">    private static final String[] NORMAL_ACCOUNTS = {</span>
            &quot;ACC-001&quot;, &quot;ACC-002&quot;, &quot;ACC-003&quot;, &quot;ACC-004&quot;, &quot;ACC-005&quot;,
            &quot;ACC-006&quot;, &quot;ACC-007&quot;, &quot;ACC-008&quot;, &quot;ACC-009&quot;, &quot;ACC-010&quot;,
            &quot;ACC-011&quot;, &quot;ACC-012&quot;, &quot;ACC-013&quot;, &quot;ACC-014&quot;, &quot;ACC-015&quot;
    };

<span class="nc" id="L64">    private static final String[] SUSPICIOUS_ACCOUNTS = {</span>
            &quot;SUSP-001&quot;, &quot;SUSP-002&quot;, &quot;WATCH-001&quot;
    };

<span class="nc" id="L68">    private static final String[] BLACKLISTED_ACCOUNTS = {</span>
            &quot;BLACK-001&quot;, &quot;BLACK-002&quot;, &quot;FRAUD-001&quot;
    };

<span class="nc" id="L72">    private static final String[] NORMAL_COUNTRIES = {</span>
            &quot;US&quot;, &quot;UK&quot;, &quot;DE&quot;, &quot;FR&quot;, &quot;JP&quot;, &quot;CA&quot;, &quot;AU&quot;, &quot;SG&quot;, &quot;HK&quot;, &quot;CN&quot;
    };

<span class="nc" id="L76">    private static final String[] HIGH_RISK_COUNTRIES = {</span>
            &quot;XX&quot;, &quot;YY&quot;
    };

<span class="nc" id="L80">    private static final String[] BLOCKED_COUNTRIES = {</span>
            &quot;ZZ&quot;
    };

<span class="nc" id="L84">    private static final String[] CHANNELS = {&quot;ONLINE&quot;, &quot;ATM&quot;, &quot;POS&quot;, &quot;MOBILE&quot;};</span>
<span class="nc" id="L85">    private static final String[] CURRENCIES = {&quot;USD&quot;, &quot;EUR&quot;, &quot;GBP&quot;, &quot;CNY&quot;, &quot;JPY&quot;};</span>
<span class="nc" id="L86">    private static final TransactionType[] TX_TYPES = TransactionType.values();</span>

    private final Publisher publisher;
    private final ObjectMapper objectMapper;
    private final String projectId;
    private final String topicId;
    private final int tps;
    private final int fraudRate;
    private final Random random;
    private final AtomicBoolean running;
    private final AtomicLong totalSent;
    private final AtomicLong fraudSent;
    private final AtomicLong failedCount;

<span class="nc" id="L100">    public PubSubTransactionProducer(String projectId, String topicId, int tps, int fraudRate) throws IOException {</span>
<span class="nc" id="L101">        this.projectId = projectId;</span>
<span class="nc" id="L102">        this.topicId = topicId;</span>
<span class="nc" id="L103">        this.tps = tps;</span>
<span class="nc" id="L104">        this.fraudRate = fraudRate;</span>
<span class="nc" id="L105">        this.random = new Random();</span>
<span class="nc" id="L106">        this.running = new AtomicBoolean(true);</span>
<span class="nc" id="L107">        this.totalSent = new AtomicLong(0);</span>
<span class="nc" id="L108">        this.fraudSent = new AtomicLong(0);</span>
<span class="nc" id="L109">        this.failedCount = new AtomicLong(0);</span>

        // Configure JSON serializer
<span class="nc" id="L112">        this.objectMapper = new ObjectMapper();</span>
<span class="nc" id="L113">        this.objectMapper.registerModule(new JavaTimeModule());</span>
<span class="nc" id="L114">        this.objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);</span>

        // Create Pub/Sub publisher
<span class="nc" id="L117">        TopicName topicName = TopicName.of(projectId, topicId);</span>
<span class="nc" id="L118">        LOG.info(&quot;Initializing Pub/Sub publisher for topic: {}&quot;, topicName);</span>
        
<span class="nc" id="L120">        this.publisher = Publisher.newBuilder(topicName)</span>
<span class="nc" id="L121">                .build();</span>

<span class="nc" id="L123">        LOG.info(&quot;PubSubTransactionProducer initialized - Project: {}, Topic: {}, TPS: {}, FraudRate: {}%&quot;,</span>
<span class="nc" id="L124">                projectId, topicId, tps, fraudRate);</span>
<span class="nc" id="L125">    }</span>

    /**
     * Start producing transactions at the configured rate.
     */
    public void start() {
<span class="nc" id="L131">        LOG.info(&quot;Starting Pub/Sub transaction producer...&quot;);</span>

<span class="nc" id="L133">        long intervalMs = 1000 / tps;</span>
<span class="nc" id="L134">        long lastLogTime = System.currentTimeMillis();</span>

        // Add shutdown hook
<span class="nc" id="L137">        Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; {</span>
<span class="nc" id="L138">            LOG.info(&quot;Shutdown signal received, stopping producer...&quot;);</span>
<span class="nc" id="L139">            running.set(false);</span>
<span class="nc" id="L140">        }));</span>

<span class="nc bnc" id="L142" title="All 2 branches missed.">        while (running.get()) {</span>
            try {
                // Decide if this should be a fraudulent transaction
<span class="nc bnc" id="L145" title="All 2 branches missed.">                boolean isFraud = random.nextInt(100) &lt; fraudRate;</span>

<span class="nc bnc" id="L147" title="All 2 branches missed.">                Transaction transaction = isFraud ? generateFraudulentTransaction() : generateNormalTransaction();</span>
<span class="nc" id="L148">                String json = objectMapper.writeValueAsString(transaction);</span>

                // Create Pub/Sub message
<span class="nc" id="L151">                ByteString data = ByteString.copyFromUtf8(json);</span>
<span class="nc" id="L152">                PubsubMessage pubsubMessage = PubsubMessage.newBuilder()</span>
<span class="nc" id="L153">                        .setData(data)</span>
<span class="nc" id="L154">                        .putAttributes(&quot;account_id&quot;, transaction.getAccountId())</span>
<span class="nc" id="L155">                        .putAttributes(&quot;transaction_type&quot;, transaction.getTransactionType().name())</span>
<span class="nc" id="L156">                        .putAttributes(&quot;country_code&quot;, transaction.getCountryCode())</span>
<span class="nc" id="L157">                        .putAttributes(&quot;is_suspicious&quot;, String.valueOf(isFraud))</span>
<span class="nc" id="L158">                        .build();</span>

                // Publish asynchronously
<span class="nc" id="L161">                ApiFuture&lt;String&gt; future = publisher.publish(pubsubMessage);</span>
                
<span class="nc" id="L163">                final boolean finalIsFraud = isFraud;</span>
<span class="nc" id="L164">                ApiFutures.addCallback(future, new ApiFutureCallback&lt;String&gt;() {</span>
                    @Override
                    public void onSuccess(String messageId) {
<span class="nc" id="L167">                        totalSent.incrementAndGet();</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">                        if (finalIsFraud) {</span>
<span class="nc" id="L169">                            fraudSent.incrementAndGet();</span>
                        }
<span class="nc" id="L171">                        LOG.debug(&quot;Published message ID: {}&quot;, messageId);</span>
<span class="nc" id="L172">                    }</span>

                    @Override
                    public void onFailure(Throwable t) {
<span class="nc" id="L176">                        failedCount.incrementAndGet();</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">                        if (t instanceof ApiException) {</span>
<span class="nc" id="L178">                            ApiException apiException = (ApiException) t;</span>
<span class="nc" id="L179">                            LOG.error(&quot;Failed to publish message. Status: {}, Error: {}&quot;, </span>
<span class="nc" id="L180">                                    apiException.getStatusCode().getCode(), </span>
<span class="nc" id="L181">                                    apiException.getMessage());</span>
<span class="nc" id="L182">                        } else {</span>
<span class="nc" id="L183">                            LOG.error(&quot;Failed to publish message: {}&quot;, t.getMessage());</span>
                        }
<span class="nc" id="L185">                    }</span>
<span class="nc" id="L186">                }, MoreExecutors.directExecutor());</span>

                // Log stats every 10 seconds
<span class="nc" id="L189">                long now = System.currentTimeMillis();</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">                if (now - lastLogTime &gt;= 10000) {</span>
<span class="nc" id="L191">                    LOG.info(&quot;Stats - Total sent: {}, Fraudulent: {} ({}%), Failed: {}, Rate: {} tx/s&quot;,</span>
<span class="nc" id="L192">                            totalSent.get(),</span>
<span class="nc" id="L193">                            fraudSent.get(),</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">                            totalSent.get() &gt; 0 ? (fraudSent.get() * 100 / totalSent.get()) : 0,</span>
<span class="nc" id="L195">                            failedCount.get(),</span>
<span class="nc" id="L196">                            tps);</span>
<span class="nc" id="L197">                    lastLogTime = now;</span>
                }

                // Sleep to maintain the target TPS
<span class="nc" id="L201">                Thread.sleep(intervalMs);</span>

<span class="nc" id="L203">            } catch (InterruptedException e) {</span>
<span class="nc" id="L204">                LOG.info(&quot;Producer interrupted&quot;);</span>
<span class="nc" id="L205">                running.set(false);</span>
<span class="nc" id="L206">            } catch (Exception e) {</span>
<span class="nc" id="L207">                LOG.error(&quot;Error producing transaction: {}&quot;, e.getMessage(), e);</span>
<span class="nc" id="L208">            }</span>
        }

<span class="nc" id="L211">        close();</span>
<span class="nc" id="L212">    }</span>

    /**
     * Generate a normal (non-fraudulent) transaction.
     */
    private Transaction generateNormalTransaction() {
<span class="nc" id="L218">        String accountId = NORMAL_ACCOUNTS[random.nextInt(NORMAL_ACCOUNTS.length)];</span>
<span class="nc" id="L219">        String targetAccountId = &quot;ACC-&quot; + String.format(&quot;%03d&quot;, random.nextInt(1000));</span>
<span class="nc" id="L220">        BigDecimal amount = new BigDecimal(random.nextInt(5000) + 10);</span>
<span class="nc" id="L221">        String country = NORMAL_COUNTRIES[random.nextInt(NORMAL_COUNTRIES.length)];</span>

<span class="nc" id="L223">        return buildTransaction(accountId, targetAccountId, amount, country);</span>
    }

    /**
     * Generate a fraudulent transaction with various fraud patterns.
     */
    private Transaction generateFraudulentTransaction() {
<span class="nc" id="L230">        int fraudType = random.nextInt(5);</span>

<span class="nc bnc" id="L232" title="All 6 branches missed.">        switch (fraudType) {</span>
            case 0:
<span class="nc" id="L234">                return generateHighValueTransaction();</span>
            case 1:
<span class="nc" id="L236">                return generateSuspiciousAccountTransaction();</span>
            case 2:
<span class="nc" id="L238">                return generateBlacklistedAccountTransaction();</span>
            case 3:
<span class="nc" id="L240">                return generateHighRiskCountryTransaction();</span>
            case 4:
<span class="nc" id="L242">                return generateBlockedCountryTransaction();</span>
            default:
<span class="nc" id="L244">                return generateHighValueTransaction();</span>
        }
    }

    private Transaction generateHighValueTransaction() {
<span class="nc" id="L249">        String accountId = NORMAL_ACCOUNTS[random.nextInt(NORMAL_ACCOUNTS.length)];</span>
<span class="nc" id="L250">        String targetAccountId = &quot;ACC-&quot; + String.format(&quot;%03d&quot;, random.nextInt(1000));</span>
<span class="nc" id="L251">        BigDecimal amount = new BigDecimal(random.nextInt(190000) + 10000);</span>
<span class="nc" id="L252">        String country = NORMAL_COUNTRIES[random.nextInt(NORMAL_COUNTRIES.length)];</span>

<span class="nc" id="L254">        Transaction tx = buildTransaction(accountId, targetAccountId, amount, country);</span>
<span class="nc" id="L255">        LOG.debug(&quot;Generated HIGH VALUE transaction: {} - Amount: {}&quot;, tx.getTransactionId(), amount);</span>
<span class="nc" id="L256">        return tx;</span>
    }

    private Transaction generateSuspiciousAccountTransaction() {
<span class="nc" id="L260">        String accountId = SUSPICIOUS_ACCOUNTS[random.nextInt(SUSPICIOUS_ACCOUNTS.length)];</span>
<span class="nc" id="L261">        String targetAccountId = &quot;ACC-&quot; + String.format(&quot;%03d&quot;, random.nextInt(1000));</span>
<span class="nc" id="L262">        BigDecimal amount = new BigDecimal(random.nextInt(10000) + 100);</span>
<span class="nc" id="L263">        String country = NORMAL_COUNTRIES[random.nextInt(NORMAL_COUNTRIES.length)];</span>

<span class="nc" id="L265">        Transaction tx = buildTransaction(accountId, targetAccountId, amount, country);</span>
<span class="nc" id="L266">        LOG.debug(&quot;Generated SUSPICIOUS ACCOUNT transaction: {} - Account: {}&quot;, tx.getTransactionId(), accountId);</span>
<span class="nc" id="L267">        return tx;</span>
    }

    private Transaction generateBlacklistedAccountTransaction() {
<span class="nc" id="L271">        String accountId = BLACKLISTED_ACCOUNTS[random.nextInt(BLACKLISTED_ACCOUNTS.length)];</span>
<span class="nc" id="L272">        String targetAccountId = &quot;ACC-&quot; + String.format(&quot;%03d&quot;, random.nextInt(1000));</span>
<span class="nc" id="L273">        BigDecimal amount = new BigDecimal(random.nextInt(50000) + 100);</span>
<span class="nc" id="L274">        String country = NORMAL_COUNTRIES[random.nextInt(NORMAL_COUNTRIES.length)];</span>

<span class="nc" id="L276">        Transaction tx = buildTransaction(accountId, targetAccountId, amount, country);</span>
<span class="nc" id="L277">        LOG.debug(&quot;Generated BLACKLISTED ACCOUNT transaction: {} - Account: {}&quot;, tx.getTransactionId(), accountId);</span>
<span class="nc" id="L278">        return tx;</span>
    }

    private Transaction generateHighRiskCountryTransaction() {
<span class="nc" id="L282">        String accountId = NORMAL_ACCOUNTS[random.nextInt(NORMAL_ACCOUNTS.length)];</span>
<span class="nc" id="L283">        String targetAccountId = &quot;ACC-&quot; + String.format(&quot;%03d&quot;, random.nextInt(1000));</span>
<span class="nc" id="L284">        BigDecimal amount = new BigDecimal(random.nextInt(20000) + 500);</span>
<span class="nc" id="L285">        String country = HIGH_RISK_COUNTRIES[random.nextInt(HIGH_RISK_COUNTRIES.length)];</span>

<span class="nc" id="L287">        Transaction tx = buildTransaction(accountId, targetAccountId, amount, country);</span>
<span class="nc" id="L288">        LOG.debug(&quot;Generated HIGH-RISK COUNTRY transaction: {} - Country: {}&quot;, tx.getTransactionId(), country);</span>
<span class="nc" id="L289">        return tx;</span>
    }

    private Transaction generateBlockedCountryTransaction() {
<span class="nc" id="L293">        String accountId = NORMAL_ACCOUNTS[random.nextInt(NORMAL_ACCOUNTS.length)];</span>
<span class="nc" id="L294">        String targetAccountId = &quot;ACC-&quot; + String.format(&quot;%03d&quot;, random.nextInt(1000));</span>
<span class="nc" id="L295">        BigDecimal amount = new BigDecimal(random.nextInt(30000) + 1000);</span>
<span class="nc" id="L296">        String country = BLOCKED_COUNTRIES[random.nextInt(BLOCKED_COUNTRIES.length)];</span>

<span class="nc" id="L298">        Transaction tx = buildTransaction(accountId, targetAccountId, amount, country);</span>
<span class="nc" id="L299">        LOG.debug(&quot;Generated BLOCKED COUNTRY transaction: {} - Country: {}&quot;, tx.getTransactionId(), country);</span>
<span class="nc" id="L300">        return tx;</span>
    }

    private Transaction buildTransaction(String accountId, String targetAccountId,
                                         BigDecimal amount, String countryCode) {
<span class="nc" id="L305">        return Transaction.builder()</span>
<span class="nc" id="L306">                .transactionId(&quot;TX-&quot; + UUID.randomUUID().toString().substring(0, 8).toUpperCase())</span>
<span class="nc" id="L307">                .accountId(accountId)</span>
<span class="nc" id="L308">                .targetAccountId(targetAccountId)</span>
<span class="nc" id="L309">                .amount(amount)</span>
<span class="nc" id="L310">                .currency(CURRENCIES[random.nextInt(CURRENCIES.length)])</span>
<span class="nc" id="L311">                .transactionType(TX_TYPES[random.nextInt(TX_TYPES.length)])</span>
<span class="nc" id="L312">                .timestamp(Instant.now())</span>
<span class="nc" id="L313">                .merchantId(&quot;MERCH-&quot; + String.format(&quot;%04d&quot;, random.nextInt(10000)))</span>
<span class="nc" id="L314">                .location(&quot;City-&quot; + random.nextInt(100))</span>
<span class="nc" id="L315">                .countryCode(countryCode)</span>
<span class="nc" id="L316">                .ipAddress(generateRandomIp())</span>
<span class="nc" id="L317">                .deviceId(&quot;DEV-&quot; + String.format(&quot;%06d&quot;, random.nextInt(1000000)))</span>
<span class="nc" id="L318">                .channel(CHANNELS[random.nextInt(CHANNELS.length)])</span>
<span class="nc" id="L319">                .build();</span>
    }

    private String generateRandomIp() {
<span class="nc" id="L323">        return random.nextInt(256) + &quot;.&quot; +</span>
<span class="nc" id="L324">               random.nextInt(256) + &quot;.&quot; +</span>
<span class="nc" id="L325">               random.nextInt(256) + &quot;.&quot; +</span>
<span class="nc" id="L326">               random.nextInt(256);</span>
    }

    public void close() {
<span class="nc" id="L330">        LOG.info(&quot;Closing Pub/Sub producer... Total sent: {}, Fraudulent: {}, Failed: {}&quot;,</span>
<span class="nc" id="L331">                totalSent.get(), fraudSent.get(), failedCount.get());</span>
        
<span class="nc bnc" id="L333" title="All 2 branches missed.">        if (publisher != null) {</span>
            try {
<span class="nc" id="L335">                publisher.shutdown();</span>
<span class="nc" id="L336">                publisher.awaitTermination(30, TimeUnit.SECONDS);</span>
<span class="nc" id="L337">            } catch (InterruptedException e) {</span>
<span class="nc" id="L338">                LOG.warn(&quot;Publisher shutdown interrupted&quot;);</span>
<span class="nc" id="L339">            }</span>
        }
<span class="nc" id="L341">    }</span>

    public static void main(String[] args) {
        // Get configuration from environment variables or command line
<span class="nc" id="L345">        String projectId = getConfig(&quot;GOOGLE_CLOUD_PROJECT&quot;, null, args, 0);</span>
<span class="nc" id="L346">        String topicId = getConfig(&quot;PUBSUB_TOPIC&quot;, DEFAULT_TOPIC, args, 1);</span>
<span class="nc" id="L347">        int tps = Integer.parseInt(getConfig(&quot;TPS&quot;, String.valueOf(DEFAULT_TPS), args, 2));</span>
<span class="nc" id="L348">        int fraudRate = Integer.parseInt(getConfig(&quot;FRAUD_RATE&quot;, String.valueOf(DEFAULT_FRAUD_RATE), args, 3));</span>

        // Validate required configuration
<span class="nc bnc" id="L351" title="All 4 branches missed.">        if (projectId == null || projectId.isEmpty()) {</span>
<span class="nc" id="L352">            System.err.println(&quot;ERROR: GOOGLE_CLOUD_PROJECT environment variable is required!&quot;);</span>
<span class="nc" id="L353">            System.err.println();</span>
<span class="nc" id="L354">            System.err.println(&quot;Usage:&quot;);</span>
<span class="nc" id="L355">            System.err.println(&quot;  Set environment variables:&quot;);</span>
<span class="nc" id="L356">            System.err.println(&quot;    GOOGLE_CLOUD_PROJECT=your-gcp-project-id&quot;);</span>
<span class="nc" id="L357">            System.err.println(&quot;    GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account-key.json&quot;);</span>
<span class="nc" id="L358">            System.err.println(&quot;    PUBSUB_TOPIC=transactions (optional, default: transactions)&quot;);</span>
<span class="nc" id="L359">            System.err.println(&quot;    TPS=10 (optional, default: 10)&quot;);</span>
<span class="nc" id="L360">            System.err.println(&quot;    FRAUD_RATE=15 (optional, default: 15)&quot;);</span>
<span class="nc" id="L361">            System.err.println();</span>
<span class="nc" id="L362">            System.err.println(&quot;  Or pass as command line arguments:&quot;);</span>
<span class="nc" id="L363">            System.err.println(&quot;    java -cp ... PubSubTransactionProducer &lt;project-id&gt; &lt;topic&gt; &lt;tps&gt; &lt;fraud-rate&gt;&quot;);</span>
<span class="nc" id="L364">            System.exit(1);</span>
        }

<span class="nc" id="L367">        System.out.println(&quot;==============================================&quot;);</span>
<span class="nc" id="L368">        System.out.println(&quot;   Pub/Sub Transaction Producer Starting      &quot;);</span>
<span class="nc" id="L369">        System.out.println(&quot;==============================================&quot;);</span>
<span class="nc" id="L370">        System.out.println(&quot;GCP Project: &quot; + projectId);</span>
<span class="nc" id="L371">        System.out.println(&quot;Pub/Sub Topic: &quot; + topicId);</span>
<span class="nc" id="L372">        System.out.println(&quot;Target TPS: &quot; + tps);</span>
<span class="nc" id="L373">        System.out.println(&quot;Fraud Rate: &quot; + fraudRate + &quot;%&quot;);</span>
<span class="nc" id="L374">        System.out.println(&quot;==============================================&quot;);</span>
<span class="nc" id="L375">        System.out.println(&quot;Press Ctrl+C to stop&quot;);</span>
<span class="nc" id="L376">        System.out.println();</span>

        try {
<span class="nc" id="L379">            PubSubTransactionProducer producer = new PubSubTransactionProducer(projectId, topicId, tps, fraudRate);</span>
<span class="nc" id="L380">            producer.start();</span>
<span class="nc" id="L381">        } catch (IOException e) {</span>
<span class="nc" id="L382">            System.err.println(&quot;Failed to initialize Pub/Sub producer: &quot; + e.getMessage());</span>
<span class="nc" id="L383">            e.printStackTrace();</span>
<span class="nc" id="L384">            System.exit(1);</span>
<span class="nc" id="L385">        }</span>
<span class="nc" id="L386">    }</span>

    private static String getConfig(String envName, String defaultValue, String[] args, int argIndex) {
        // Priority: command line args &gt; environment variable &gt; default
<span class="nc bnc" id="L390" title="All 8 branches missed.">        if (args != null &amp;&amp; args.length &gt; argIndex &amp;&amp; args[argIndex] != null &amp;&amp; !args[argIndex].isEmpty()) {</span>
<span class="nc" id="L391">            return args[argIndex];</span>
        }
<span class="nc" id="L393">        String envValue = System.getenv(envName);</span>
<span class="nc bnc" id="L394" title="All 4 branches missed.">        if (envValue != null &amp;&amp; !envValue.isEmpty()) {</span>
<span class="nc" id="L395">            return envValue;</span>
        }
<span class="nc" id="L397">        return defaultValue;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>